# -*- coding: utf-8 -*-
"""HP_Model.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/177Pd7GZjtEDpgY9XxpPjPe44c7M0fBh-

# Housing prediction model
"""

url = r"/content/Housing.csv"
import pandas as pd
import numpy as np

df = pd.read_csv(url)
df.info()

df.describe()

# pd.reset_option('display.max_rows') default
# pd.set_option('display.max_rows', None) max rows

df['price'].isnull()

df.isnull().sum()
x_encoded = pd.get_dummies(df,drop_first=True)
x_encoded.dtypes

x_encoded

# bool_cols = x_encoded.select_dtypes(include='bool').columns (selecting the cloumns which only conatian dtype of bool)
# x_encoded[bool_cols] = x_encoded[bool_cols].astype(int) (and chaning the type to int)
# x_encoded

"""Phase 1
Using just numerical features
(Phase 2 will be all features)
"""

# features
# X = 2d should be 2d
# y = 1d should be 1d
X = df[['area','bedrooms','bathrooms','stories','parking']]
y = df['price']
print(X.head())
print(y.head())
print(y.shape)
X.shape

from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error
from sklearn.metrics import r2_score

X_Train, X_test, y_train, y_test = train_test_split(X,y,test_size=0.2, random_state=42)

model = LinearRegression()
model.fit(X_Train,y_train)
print('w :',model.coef_)
print('b :',model.intercept_)

y_pred = model.predict(X_test)

"""phase 1 metrics"""

mse = mean_squared_error(y_test,y_pred)
print('MSE :',mse)

import math
RMSE = math.sqrt(mse)
print('RMSE : ',RMSE)

rsq = r2_score(y_test,y_pred)
print('R^2 : ',rsq)

print(mse)
print(RMSE)
print(rsq)

"""visulaize

Actual price vs predicted price
"""

import matplotlib.pyplot as plt

plt.scatter(y_test,y_pred)
# plt.plot([y_test.min(), y_test.max()], [y_test.min(), y_test.max()], '--', linewidth=1, label='ideal')
plt.xlabel('Actual prices')
plt.ylabel('Predicted prices')
plt.title('HP predictions')
plt.show()


# X = X.reshape(-1,1)
# print(X)
# plt.scatter(X,y)
# y_line = model.predict(X)
# plt.plot(X,y_line)
# plt.show()

input_feature = 'bedrooms'
# plt.figure(figsize=(20, 20))
# plt.ylim(0, 1)
# plt.yticks(range(0, 1, .1))
plt.scatter(X_test[input_feature],y_test)
plt.xlabel(input_feature)
plt.ylabel('price')
plt.show()

X.dtypes

"""Phase 2"""

# price is removed
x_encoded = x_encoded.drop('price',axis=1)
x_encoded
# y_encoded = df['price']
# y_encoded
y_encoded = df['price']
y_encoded
print(x_encoded.shape)
print(y_encoded.shape)
x_encoded

"""you can use copy if you dont want to overwrite
a = df.copy()
"""

x_encoded_train,x_encoded_test,y_encoded_train,y_encoded_test = train_test_split(x_encoded,
                                                                                 y_encoded,
                                                                                 test_size=0.2,
                                                                                 random_state=42)

print(x_encoded_train.shape,x_encoded_test.shape)
print(y_encoded_train.shape,y_encoded_test.shape)

model = LinearRegression()
model.fit(x_encoded_train,y_encoded_train)
print("w : ",model.coef_)
print("b : ",model.intercept_)

"""the w in ascending oder"""

coff_df = pd.DataFrame({
    'Features' : x_encoded_train.columns,
    'coffecient' : model.coef_
})

coff_df.sort_values(by='coffecient',ascending=True)

# for i in (x_encoded_train.columns):
  # print(index(i))

"""predicions"""

y_encoded_pred = model.predict(x_encoded_test)
print(y_encoded_test[:5])
print()
print(y_encoded_pred[:5])

"""MSE (Mean squared Error)"""

mse2 = mean_squared_error(y_encoded_test,y_encoded_pred)
print('MSE : ',mse2)

"""RMSE = sqrt(MSE)"""

import math

RMSE2 = math.sqrt(mse)
print('RMSE :',RMSE2)

"""R Square"""

r2 = r2_score(y_encoded_test,y_encoded_pred)
print('R2 : ',r2)

print(mse2)
print(RMSE2)
print(r2)

print(y_encoded_test.max())
print(y_encoded_test.min())

"""Visulaize"""

plt.scatter(y_encoded_test,y_encoded_pred)
plt.xlabel('actual prices')
plt.ylabel('predicted prices')
plt.title('Actual vs predicted')
plt.plot([y_encoded_test.min(),y_encoded_test.max()],[y_encoded_test.min(),y_encoded_test.max()],color = 'red')
plt.ticklabel_format(style='plain',axis='both')
plt.show()

residuals = y_test - y_pred

plt.figure(figsize=(8, 6))
plt.scatter(y_pred, residuals, alpha=0.7)
plt.axhline(0, color='red')
plt.xlabel("Predicted Price")
plt.ylabel("Residuals")
plt.title("Residuals vs Predicted")
plt.ticklabel_format(style='plain', axis='both')
plt.show()

plt.figure(figsize=(8, 6))
plt.hist(residuals, bins=30)
plt.xlabel("Prediction Error")
plt.ylabel("Count")
plt.title("Distribution of Errors")
plt.ticklabel_format(style='plain', axis='x')
plt.show()